# =============================================================================
# TLP CONFIGURATION - HP EliteBook x360 1030 G2
# =============================================================================
# Author: merneo
# System: HP EliteBook x360 1030 G2 (Intel i5-7300U)
# Purpose: Power management optimization for Intel 7th-gen laptop
#
# File Location: /etc/tlp.d/01-elitebook.conf
# After modifying, apply changes:
#   sudo tlp start
#
# Check current status:
#   sudo tlp-stat -s
#   sudo tlp-stat -b  (battery)
#   sudo tlp-stat -p  (CPU)
# =============================================================================

# =============================================================================
# CPU FREQUENCY SCALING
# =============================================================================
# Intel Core i5-7300U uses intel_pstate driver.
# powersave governor provides good balance of performance and battery life.
# =============================================================================

# CPU scaling governor (intel_pstate driver)
CPU_SCALING_GOVERNOR_ON_AC=performance
CPU_SCALING_GOVERNOR_ON_BAT=powersave

# CPU energy/performance policies (intel_pstate)
# Values: performance, balance_performance, default, balance_power, power
CPU_ENERGY_PERF_POLICY_ON_AC=balance_performance
CPU_ENERGY_PERF_POLICY_ON_BAT=balance_power

# CPU frequency limits (MHz) - i5-7300U: 400-3500 MHz
# Comment out to use full range
#CPU_MIN_PERF_ON_AC=0
#CPU_MAX_PERF_ON_AC=100
#CPU_MIN_PERF_ON_BAT=0
#CPU_MAX_PERF_ON_BAT=80

# Intel CPU HWP (Hardware P-states) dynamic boost
CPU_HWP_DYN_BOOST_ON_AC=1
CPU_HWP_DYN_BOOST_ON_BAT=0

# =============================================================================
# PLATFORM PROFILE (Intel specific)
# =============================================================================
# Available: performance, balanced, low-power
# =============================================================================

PLATFORM_PROFILE_ON_AC=balanced
PLATFORM_PROFILE_ON_BAT=low-power

# =============================================================================
# DISK DEVICES
# =============================================================================
# NVMe SSD optimization - aggressive power management on battery
# =============================================================================

# Disk APM level (1=min power, 254=max performance, 255=off)
DISK_APM_LEVEL_ON_AC="254"
DISK_APM_LEVEL_ON_BAT="128"

# AHCI link power management (SATA)
# Values: min_power, med_power_with_dipm, max_performance
SATA_LINKPWR_ON_AC="max_performance"
SATA_LINKPWR_ON_BAT="med_power_with_dipm"

# NVMe power saving
NVME_APST_ON_AC=1
NVME_APST_ON_BAT=1

# =============================================================================
# PCI EXPRESS POWER MANAGEMENT
# =============================================================================
# Runtime PM for PCI(e) devices
# =============================================================================

# Runtime PM (auto = enable, on = disable)
RUNTIME_PM_ON_AC=on
RUNTIME_PM_ON_BAT=auto

# PCI Express ASPM (Active State Power Management)
# Values: default, performance, powersave, powersupersave
PCIE_ASPM_ON_AC=default
PCIE_ASPM_ON_BAT=powersupersave

# =============================================================================
# WIFI POWER SAVING
# =============================================================================
# Intel Wireless 8265 - iwlwifi driver
# Power save can cause latency, disable for stability
# =============================================================================

# WiFi power saving mode (on battery)
# 0=off, 1=on
WIFI_PWR_ON_AC=off
WIFI_PWR_ON_BAT=on

# =============================================================================
# AUDIO POWER SAVING
# =============================================================================
# Intel HDA audio controller power management
# =============================================================================

# Audio power save (seconds before sleep, 0=off)
SOUND_POWER_SAVE_ON_AC=0
SOUND_POWER_SAVE_ON_BAT=1

# HDA controller power save
SOUND_POWER_SAVE_CONTROLLER=Y

# =============================================================================
# USB AUTOSUSPEND
# =============================================================================
# USB autosuspend is DISABLED via kernel parameter (usbcore.autosuspend=-1)
# to prevent USB device disconnection issues on EliteBook.
# TLP respects kernel parameter, but we explicitly set it here too.
# =============================================================================

# USB autosuspend mode (0=off, 1=on)
USB_AUTOSUSPEND=0

# Exclude specific USB devices from autosuspend (by ID)
# Format: "VID:PID VID:PID ..."
# 138a:0092 = Validity fingerprint reader
# 04f2:b58f = HP HD Camera
# 04f2:b58e = HP IR Camera
USB_EXCLUDE_BTUSB=1
USB_DENYLIST="138a:0092 04f2:b58f 04f2:b58e"

# =============================================================================
# BATTERY CHARGE THRESHOLDS
# =============================================================================
# HP EliteBook supports battery charge thresholds via hp_wmi module.
# Setting thresholds extends battery lifespan significantly.
#
# Recommended:
#   START_CHARGE: 75% - Start charging when below this level
#   STOP_CHARGE:  80% - Stop charging when this level reached
#
# This keeps battery between 75-80%, optimal for Li-ion longevity.
# =============================================================================

# Battery charge thresholds (if supported by hardware)
# Uncomment if your system supports it (check with tlp-stat -b)
#START_CHARGE_THRESH_BAT0=75
#STOP_CHARGE_THRESH_BAT0=80

# =============================================================================
# RADIO DEVICES
# =============================================================================
# Bluetooth and WiFi radio state management
# =============================================================================

# Restore radio device state on boot (0=disable, 1=enable)
RESTORE_DEVICE_STATE_ON_STARTUP=1

# Devices to disable on startup
# DEVICES_TO_DISABLE_ON_STARTUP="bluetooth"

# Devices to enable on startup
DEVICES_TO_ENABLE_ON_STARTUP="wifi"

# Devices to disable on LAN connect
#DEVICES_TO_DISABLE_ON_LAN_CONNECT="wifi"

# Devices to enable on LAN disconnect
#DEVICES_TO_ENABLE_ON_LAN_DISCONNECT="wifi"

# =============================================================================
# MISC POWER SAVING
# =============================================================================

# Enable/disable kernel NMI watchdog (0=disable saves power)
NMI_WATCHDOG=0

# SCHED_MC power savings mode (deprecated on modern kernels)
# SCHED_POWERSAVE_ON_AC=0
# SCHED_POWERSAVE_ON_BAT=1
